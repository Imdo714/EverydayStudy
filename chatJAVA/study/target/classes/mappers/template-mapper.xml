<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
   
<!-- namespace: 해당 mapper파일의 고유한 별칭 -->
<mapper namespace="TemplateMapper">

	<resultMap type="Template" id="templateResult">
		<result column="TEMPLATE_NO" property="templateNo" />
		<result column="TEMPLATE_TITLE" property="templateTitle" />
		<result column="TEMPLATE_CONTENT" property="templateContent" />
		<result column="TEMPLATE_DATE" property="templateDate" />
		<result column="USER_NO" property="userNo" />
		<result column="CATEGORY_NO" property="categoryNo" />
		<result column="TEMPLATE_IMG_URL" property="templateImgUrl" />
		<result column="TEMPLATE_CHANG_NAME" property="templateChangName" />
	</resultMap>
	
	<resultMap type="TemplateImg" id="templateImgResult">
		<result column="TEMPLATE_IMG_NO" property="templateImgNo" />
		<result column="TEMPLATE_IMG_URL" property="templateImgUrl" />
		<result column="TEMPLATE_ORGIN_NAME" property="templateOrginName" />
		<result column="TEMPLATE_CHANG_NAME" property="templateChangName" />
		<result column="TEMPLATE_THUMBNAIL" property="templateThumbnail" />
		<result column="TEMPLATE_NO" property="templateNo" />
	</resultMap>
	
	<resultMap type="TemplateReply" id="templateReplyResult">
		<result column="TEMPLATE_REPLY_NO" property="templateReplyNo" />
		<result column="TEMPLATE_REPLY_CONTENT" property="templateReplyContent" />
		<result column="TEMPLATE_REPLY_DATE" property="templateReplyDate" />
		<result column="USER_NO" property="userNo" />
		<result column="TEMPLATE_NO" property="templateNo" />
	</resultMap>


	<!-- 템플릿 올리기 -->
  	<insert id="templateInsert" parameterType="map">
		INSERT INTO TEMPLATE(
			TEMPLATE_NO,
			TEMPLATE_TITLE,
			TEMPLATE_CONTENT,
			TEMPLATE_DATE,
			USER_NO,
			CATEGORY_NO
			)
		VALUES (
			SEQ_TEMPLATE.NEXTVAL,
			#{t.templateTitle},
			#{t.templateContent},
			SYSDATE,
			#{userNo},
			#{t.categoryNo}
			)
	</insert>
	
	<!-- 템플릿 썸네일 올리기 -->
  	<insert id="templateTitleImg">
		INSERT INTO TEMPLATE_IMG(
			TEMPLATE_IMG_NO,
			TEMPLATE_IMG_URL,
			TEMPLATE_ORGIN_NAME,
			TEMPLATE_CHANG_NAME,
			TEMPLATE_THUMBNAIL,
			TEMPLATE_NO
			)
		VALUES (
			SEQ_TEMPLATE_IMG.NEXTVAL,
			#{templateImgUrl},
			#{templateOrginName},
			#{templateChangName},
			2, 
			SEQ_TEMPLATE.CURRVAL
			)
	</insert>
	
	<!-- 템플릿 총 갯수 -->
	<select id="selectListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM TEMPLATE
	</select>
	
	<!-- 템플릿 리스트 정보 가져오기  -->
	<select id="selectTemplateList" resultMap="templateResult">
				SELECT *
        FROM(
                SELECT ROWNUM RNUM, A.*
                FROM (
                        SELECT TEMPLATE_NO,
                               TEMPLATE_TITLE,
                               TEMPLATE_CONTENT,
                               TEMPLATE_DATE,
                               USER_NO,
                               CATEGORY_NO,
                               TEMPLATE_IMG_URL,
                               TEMPLATE_CHANG_NAME
                        FROM TEMPLATE
                        JOIN TEMPLATE_IMG USING(TEMPLATE_NO)
                        ORDER BY TEMPLATE_NO DESC
                    ) A
                )
	</select>
	
	<!-- 디테일 템플릿 정보 -->
	<select id="detailTemplate" resultMap="templateResult">
		 SELECT TEMPLATE_NO,
			    TEMPLATE_TITLE,
				TEMPLATE_CONTENT,
				TEMPLATE_DATE,
				USER_NO,
				CATEGORY_NO
		   FROM TEMPLATE
		  WHERE TEMPLATE_NO = #{tno}
	</select>
	
	<!-- 템플릿 수정 업데이트  -->
	<update id="updateTemplate">
		UPDATE TEMPLATE 
		       SET 
		       TEMPLATE_CONTENT = #{templateContent}
		       WHERE
		       TEMPLATE_NO = #{templateNo}
	</update>
	
	<!-- 댓글 작성 -->
  	<insert id="replyInsert" parameterType="map">
		INSERT INTO 
			TEMPLATE_REPLY(
			TEMPLATE_REPLY_NO,
			TEMPLATE_REPLY_CONTENT,
			TEMPLATE_REPLY_DATE,
			USER_NO,
			TEMPLATE_NO
			)
		VALUES (
			SEQ_TEMPLATE_REPLY.NEXTVAL,
			#{r.templateReplyContent},
			SYSDATE,
			#{userNo},
			#{r.templateNo}
			)
	</insert>
</mapper>